@page "/departments"
@using XMS.Modules.Departments.Domain

<MudContainer MaxWidth="MaxWidth.Medium">
	<MudPaper>
		<MudToolBar>
			<MudStack Row="true" Spacing="6">
				<MudText Typo="Typo.h5">Схема предприятия</MudText>
				<MudFab Color="Color.Primary"
						Size="Size.Small"
						StartIcon="@(_expandedAll ? Icons.Material.Filled.VerticalAlignCenter : Icons.Material.Filled.Expand)"
						OnClick="@(_expandedAll ? CollapseAll : ExpandAll)"
						title="Свернуть все" />
			</MudStack>
		</MudToolBar>
		<MudTreeView Items="_treeItems" T="Department" Dense="true">
			<ItemTemplate Context="item">
				<MudTreeViewItem Expanded="@item.Expanded"
								 ExpandedChanged="@((expanded) => ExpandedChanged(item, expanded))"
								 Items="@item.Children"
								 Value="@item.Value">
					<Content>
						<MudTreeViewItemToggleButton Expanded="@item.Expanded"
													 ExpandedChanged="@((expanded) => ExpandedChanged(item, expanded))"
													 Visible="@item.HasChildren" />
						<MudIcon Icon="@GetIcon(item)" Size="@(item.HasChildren? Size.Medium: Size.Small)" Class="mr-2" />
						<MudText Typo="@(item.HasChildren? Typo.body1: Typo.body2)">@item.Value?.Name</MudText>
						<MudMenu Icon="@Icons.Material.Filled.MoreVert"
								 Size="Size.Medium"
								 AnchorOrigin="Origin.TopRight"
								 TransformOrigin="Origin.TopLeft"
								 Dense="true"
								 AriaLabel="Open menu">
							<MudMenuItem Label="Добавить Подразделение" Icon="@Icons.Material.Filled.CreateNewFolder" OnClick="() => NewDepartmentAsync(item.Value)" />
							@if (item.Value is Department department && department.ParentId is not null)
							{
								<MudMenuItem Label="Изменить это Подразделение" Icon="@Icons.Material.Filled.Edit" OnClick="() => EditDepartmentAsync(item.Value)" />
								<MudMenuItem Label="Удалить это Подразделение" Icon="@Icons.Material.Filled.Delete" OnClick="() => DeleteDepartmentAsync(item.Value)" />
							}
						</MudMenu>
					</Content>
				</MudTreeViewItem>
			</ItemTemplate>
		</MudTreeView>
	</MudPaper>
</MudContainer>